<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"  lang="en-us">
    <title>Analyzing NetHack data, part 2: What players kill the most - Econometrics and Free Software</title>
    <meta name="generator" content="Hugo 0.25.1" />

    
    <meta name="description" content="A blog about econometrics, free software, and R">
    
    <link rel="canonical" href="../../blog/2018-11-10-nethack_analysis_part2/">
    
    <meta name="author" content="Bruno Rodrigues">
    
    <meta name="generator" content="Hugo 0.25.1" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:url" content="/blog/2018-11-10-nethack_analysis_part2/">
    <meta property="og:title" content="Econometrics and Free Software">
    <meta property="og:image" content="/map[height:50 alt:Logo url:logo.png width:50]">
    <meta name="apple-mobile-web-app-title" content="Econometrics and Free Software">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="shortcut icon" type="image/x-icon" href="../../images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="../../images/favicon.ico">

    
    <link rel="stylesheet" href="../../css/bootstrap.min.css" media="screen">
    <link rel="stylesheet" href="../../css/custom.css">
    <link rel="stylesheet" href="../../css/pygments.css">
    
    <link rel="stylesheet" href="../../css/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen" />
  </head>
  <body>


<div class="row">
<div class="navbar navbar-default navbar-fixed-top">
<div class="container">
  <div class="navbar-header">
    <a href="../../" class="navbar-brand">Econometrics and Free Software</a>
    <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  </div>
  <div class="navbar-collapse collapse" id="navbar-main">

    <ul class="nav navbar-nav navbar-right">
      <li><a href="https://www.buymeacoffee.com/brodriguesco">Donate</a></li>
      <li><a href="https://www.youtube.com/c/BrunoRodrigues1988">Youtube</a></li>
      <li><a href="https://github.com/b-rodrigues/">Github</a></li>
      <li><a href="https://twitter.com/brodriguesco/">Twitter</a></li>
    </ul>
  </div>
</div>

</div>

<div class="container">

  <div>
    <div class="row">
      <div class="col-lg-3 col-md-3 col-sm-4">
        

<div class="list-group table-of-contents">

  
    <a class="list-group-item" href=#><b>About Me</b></a>
    
    <div class="list-group">
      
      <a class="list-group-item" href="../../about/about/">Who am I?</a>
      
      <a class="list-group-item" href="../../about/projects/">Projects</a>
      
      <a class="list-group-item" href="../../about/research/">Research</a>
      
      <a class="list-group-item" href="../../about/software/">Software</a>
      
    </div>
    
  
    <a class="list-group-item" href=#><b>Blog</b></a>
    
    <div class="list-group">
      
      <a class="list-group-item" href="../../blog/2018-11-25-tidy_cv/">A tutorial on tidy cross-validation with R</a>
      
      <a class="list-group-item" href="../../blog/2018-11-03-nethack_analysis/">Analyzing NetHack data, part 1: What kills the players</a>
      
      <a class="list-group-item" href="../../blog/2018-11-10-nethack_analysis_part2/">Analyzing NetHack data, part 2: What players kill the most</a>
      
      <a class="list-group-item" href="../../blog/2019-02-04-newspapers_shiny_app_tutorial/">Building a shiny app to explore historical newspapers: a step-by-step guide</a>
      
      <a class="list-group-item" href="../../blog/2019-03-03-historical_vowpal/">Classification of historical newspapers content: a tutorial combining R, bash and Vowpal Wabbit, part 1</a>
      
      <a class="list-group-item" href="../../blog/2019-03-05-historical_vowpal_part2/">Classification of historical newspapers content: a tutorial combining R, bash and Vowpal Wabbit, part 2</a>
      
      <a class="list-group-item" href="../../blog/2019-06-20-tidy_eval_saga/">Curly-Curly, the successor of Bang-Bang</a>
      
      <a class="list-group-item" href="../../blog/2018-07-08-rob_stderr/">Dealing with heteroskedasticity; regression with robust standard errors using R</a>
      
      <a class="list-group-item" href="../../blog/2018-11-14-luxairport/">Easy time-series prediction with R: a tutorial with air traffic data from Lux Airport</a>
      
      <a class="list-group-item" href="../../blog/2018-10-05-ggplot2_purrr_officer/">Exporting editable plots from R to Powerpoint: making ggplot2 purrr with officer</a>
      
      <a class="list-group-item" href="../../blog/2019-04-28-diffindiff_part1/">Fast food, causality and R packages, part 1</a>
      
      <a class="list-group-item" href="../../blog/2019-05-04-diffindiff_part2/">Fast food, causality and R packages, part 2</a>
      
      <a class="list-group-item" href="../../blog/2019-05-18-xml2/">For posterity: install {xml2} on GNU/Linux distros</a>
      
      <a class="list-group-item" href="../../blog/2018-06-24-fun_ts/">Forecasting my weight with R</a>
      
      <a class="list-group-item" href="../../blog/2018-11-01-nethack/">From webscraping data to releasing it as an R package to share with the world: a full tutorial with data from NetHack</a>
      
      <a class="list-group-item" href="../../blog/2019-03-31-tesseract/">Get text from pdfs or images using OCR: a tutorial with {tesseract} and {magick}</a>
      
      <a class="list-group-item" href="../../blog/2018-06-10-scraping_pdfs/">Getting data from pdfs using the pdftools package</a>
      
      <a class="list-group-item" href="../../blog/2018-10-21-lux_elections/">Getting the data from the Luxembourguish elections out of Excel</a>
      
      <a class="list-group-item" href="../../blog/2018-09-11-human_to_machine/">Going from a human readable Excel file to a machine-readable csv with {tidyxl}</a>
      
      <a class="list-group-item" href="../../blog/2019-04-07-historical_newspaper_scraping_tesseract/">Historical newspaper scraping with {tesseract} and R</a>
      
      <a class="list-group-item" href="../../blog/2018-09-15-time_use/">How Luxembourguish residents spend their time: a small {flexdashboard} demo using the Time use survey data</a>
      
      <a class="list-group-item" href="../../blog/2018-04-14-playing_with_furrr/">Imputing missing values in parallel using {furrr}</a>
      
      <a class="list-group-item" href="../../blog/2019-06-12-intermittent/">Intermittent demand, Croston and Die Hard</a>
      
      <a class="list-group-item" href="../../blog/2019-01-04-newspapers/">Looking into 19th century ads from a Luxembourguish newspaper with R</a>
      
      <a class="list-group-item" href="../../blog/2019-01-13-newspapers_mets_alto/">Making sense of the METS and ALTO XML standards</a>
      
      <a class="list-group-item" href="../../blog/2018-12-15-lubridate_africa/">Manipulate dates easily with {lubridate}</a>
      
      <a class="list-group-item" href="../../blog/2019-02-10-stringr_package/">Manipulating strings with the {stringr} package</a>
      
      <a class="list-group-item" href="../../blog/2018-10-27-lux_elections_analysis/">Maps with pie charts on top of each administrative division: an example with Luxembourg&#39;s elections data</a>
      
      <a class="list-group-item" href="../../blog/2018-07-01-tidy_ive/">Missing data imputation and instrumental variables regression: the tidy approach</a>
      
      <a class="list-group-item" href="../../blog/2019-08-17-modern_r/">Modern R with the tidyverse is available on Leanpub</a>
      
      <a class="list-group-item" href="../../blog/2018-12-24-modern_objects/">Objects types and some useful R functions for beginners</a>
      
      <a class="list-group-item" href="../../blog/2019-03-20-pivot/">Pivoting data frames just got easier thanks to `pivot_wide()` and `pivot_long()`</a>
      
      <a class="list-group-item" href="../../blog/2018-12-30-reticulate/">R or Python? Why not both? Using Anaconda Python within R with {reticulate}</a>
      
      <a class="list-group-item" href="../../blog/2018-11-15-tidy_gridsearch/">Searching for the optimal hyper-parameters of an ARIMA model in parallel: the tidy gridsearch approach</a>
      
      <a class="list-group-item" href="../../blog/2018-12-27-fun_gganimate/">Some fun with {gganimate}</a>
      
      <a class="list-group-item" href="../../blog/2019-10-05-parallel_maxlik/">Split-apply-combine for Maximum Likelihood Estimation of a linear model</a>
      
      <a class="list-group-item" href="../../blog/2019-07-19-statmatch/">Statistical matching, or when one single data source is not enough</a>
      
      <a class="list-group-item" href="../../blog/2018-11-21-lux_castle/">The best way to visit Luxembourguish castles is doing data science &#43; combinatorial optimization</a>
      
      <a class="list-group-item" href="../../blog/2019-05-19-spacemacs/">The never-ending editor war (?)</a>
      
      <a class="list-group-item" href="../../blog/2018-09-08-steam_linux/">The year of the GNU&#43;Linux desktop is upon us: using user ratings of Steam Play compatibility to play around with regex and the tidyverse</a>
      
      <a class="list-group-item" href="../../blog/2019-01-31-newspapers_shiny_app/">Using Data Science to read 10 years of Luxembourguish newspapers from the 19th century</a>
      
      <a class="list-group-item" href="../../blog/2018-11-16-rgenoud_arima/">Using a genetic algorithm for the hyperparameter optimization of a SARIMA model</a>
      
      <a class="list-group-item" href="../../blog/2019-06-04-cosine_sim/">Using cosine similarity to find matching documents: a tutorial using Seneca&#39;s letters to his friend Lucilius</a>
      
      <a class="list-group-item" href="../../blog/2019-08-14-lpm/">Using linear models with binary dependent variables, a simulation study</a>
      
      <a class="list-group-item" href="../../blog/2018-12-21-tidyverse_pi/">Using the tidyverse for more than data manipulation: estimating pi with Monte Carlo methods</a>
      
      <a class="list-group-item" href="../../blog/2018-12-02-hyper-parameters/">What hyper-parameters are, and what to do with them; an illustration with ridge regression</a>
      
      <a class="list-group-item" href="../../blog/2019-09-03-disk_frame/">{disk.frame} is epic</a>
      
      <a class="list-group-item" href="../../blog/2018-04-15-announcing_pmice/">{pmice}, an experimental package for missing data imputation in parallel using {mice} and {furrr}</a>
      
      <a class="list-group-item" href="../../blog/2017-12-27-build_formulae/">Building formulae</a>
      
      <a class="list-group-item" href="../../blog/2017-11-14-peace_r/">Functional peace of mind</a>
      
      <a class="list-group-item" href="../../blog/2018-04-10-brotools_describe/">Get basic summary statistics for all the variables in a data frame</a>
      
      <a class="list-group-item" href="../../blog/2018-03-03-sparklyr_h2o_rsparkling/">Getting {sparklyr}, {h2o}, {rsparkling} to work together and some fun with bash</a>
      
      <a class="list-group-item" href="../../blog/2018-02-16-importing_30gb_of_data/">Importing 30GB of data into R with sparklyr</a>
      
      <a class="list-group-item" href="../../blog/2017-03-27-introducing_brotools/">Introducing brotools</a>
      
      <a class="list-group-item" href="../../blog/2018-01-03-lists_all_the_way/">It&#39;s lists all the way down</a>
      
      <a class="list-group-item" href="../../blog/2018-01-05-lists_all_the_way2/">It&#39;s lists all the way down, part 2: We need to go deeper</a>
      
      <a class="list-group-item" href="../../blog/2018-03-12-keep_trying/">Keep trying that api call with purrr::possibly()</a>
      
      <a class="list-group-item" href="../../blog/2017-06-19-dplyr-0-70-tutorial/">Lesser known dplyr 0.7* tricks</a>
      
      <a class="list-group-item" href="../../blog/2017-02-17-lesser_known_tricks/">Lesser known dplyr tricks</a>
      
      <a class="list-group-item" href="../../blog/2017-03-24-lesser_known_purrr/">Lesser known purrr tricks</a>
      
      <a class="list-group-item" href="../../blog/2017-03-29-make-ggplot2-purrr/">Make ggplot2 purrr</a>
      
      <a class="list-group-item" href="../../blog/2018-01-19-mapping_functions_with_any_cols/">Mapping a list of functions to a list of datasets with a list of columns as arguments</a>
      
      <a class="list-group-item" href="../../blog/2018-02-11-census-random_forest/">Predicting job search by training a random forest on an unbalanced dataset</a>
      
      <a class="list-group-item" href="../../blog/2017-12-17-teaching_tidyverse/">Teaching the tidyverse to beginners</a>
      
      <a class="list-group-item" href="../../blog/2017-08-27-why_tidyeval/">Why I find tidyeval useful</a>
      
      <a class="list-group-item" href="../../blog/2017-07-27-spread_rename_at/">tidyr::spread() and dplyr::rename_at() in action</a>
      
      <a class="list-group-item" href="../../blog/2017-10-26-margins_r/">Easy peasy STATA-like marginal effects with R</a>
      
      <a class="list-group-item" href="../../blog/2016-12-24-functional-programming-and-unit-testing-for-data-munging-with-r-available-on-leanpub/">Functional programming and unit testing for data munging with R available on Leanpub</a>
      
      <a class="list-group-item" href="../../blog/2017-02-17-how_to_use_jailbreakr/">How to use jailbreakr</a>
      
      <a class="list-group-item" href="../../blog/2017-01-07-my-free-book-has-a-cover/">My free book has a cover!</a>
      
      <a class="list-group-item" href="../../blog/2016-12-21-work-on-lists-of-datasets-instead-of-individual-datasets-by-using-functional-programming/">Work on lists of datasets instead of individual datasets by using functional programming</a>
      
      <a class="list-group-item" href="../../blog/2013-01-29-method-of-simulated-moments-with-r/">Method of Simulated Moments with R</a>
      
      <a class="list-group-item" href="../../blog/2012-12-11-new-website/">New website!</a>
      
      <a class="list-group-item" href="../../blog/2013-11-07-gmm-with-rmd/">Nonlinear Gmm with R - Example with a logistic regression</a>
      
      <a class="list-group-item" href="../../blog/2013-01-16-simulated-maximum-likelihood-with-r/">Simulated Maximum Likelihood with R</a>
      
      <a class="list-group-item" href="../../blog/2015-11-11-bootstrapping-did-with-r/">Bootstrapping standard errors for difference-in-differences estimation with R</a>
      
      <a class="list-group-item" href="../../blog/2016-06-21-careful-with-trycatch/">Careful with tryCatch</a>
      
      <a class="list-group-item" href="../../blog/2016-07-18-data-frame-columns-as-arguments-to-dplyr-functions/">Data frame columns as arguments to dplyr functions</a>
      
      <a class="list-group-item" href="../../blog/2015-02-22-export-r-output-to-file/">Export R output to a file</a>
      
      <a class="list-group-item" href="../../blog/2016-11-04-ive-started-writing-a-book-functional-programming-and-unit-testing-for-data-munging-with-r/">I&#39;ve started writing a &#39;book&#39;: Functional programming and unit testing for data munging with R</a>
      
      <a class="list-group-item" href="../../blog/2015-01-12-introduction-to-programming-econometrics-with-r/">Introduction to programming econometrics with R</a>
      
      <a class="list-group-item" href="../../blog/2016-07-30-merge-a-list-of-datasets-together/">Merge a list of datasets together</a>
      
      <a class="list-group-item" href="../../blog/2014-04-23-r-s4-rootfinding/">Object Oriented Programming with R: An example with a Cournot duopoly</a>
      
      <a class="list-group-item" href="../../blog/2014-11-11-benchmarks-r-blas-atlas-rro/">R, R with Atlas, R with OpenBLAS and Revolution R Open: which is fastest?</a>
      
      <a class="list-group-item" href="../../blog/2016-07-26-read-a-lot-of-datasets-at-once-with-r/">Read a lot of datasets at once with R</a>
      
      <a class="list-group-item" href="../../blog/2016-03-31-unit-testing-with-r/">Unit testing with R</a>
      
      <a class="list-group-item" href="../../blog/2015-05-03-update-introduction-r-programming/">Update to Introduction to programming econometrics with R</a>
      
      <a class="list-group-item" href="../../blog/2013-12-31-r-cas/">Using R as a Computer Algebra System with Ryacas</a>
      
    </div>
    
  

</div>

      </div>
      <div class="col-lg-9 col-md-9 col-sm-8">
        <div>
           <h1 id="main">Analyzing NetHack data, part 2: What players kill the most</h1>
           <span class="article-date">November 10, 2018</span>
        </div>
        <div style="text-align:center;">
<p><a href="https://www.youtube.com/watch?v=VnW2g6qbbrA">
<img src="../../img/monsters.png" title = "Wizard of Yendor battle music"></a></p>
</div>
<p>Link to <a href="https://www.brodrigues.co/blog/2018-11-01-nethack/">webscraping the data</a></p>
<p>Link to <a href="https://www.brodrigues.co/blog/2018-11-03-nethack_analysis/">Analysis, part 1</a></p>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This is the third blog post that deals with data from the game NetHack, and oh boy, did a lot of
things happen since the last blog post! Here’s a short timeline of the events:</p>
<ul>
<li>I scraped data from <a href="https://alt.org/nethack/">alt.org/nethack</a> and made a package with the data available on Github
(that package was too big for CRAN)</li>
<li>Then, I analyzed the data, focusing on what monsters kill the players the most, and also where
players die the most</li>
<li><span class="citation">@GridSageGames</span>, developer of the roguelike Cogmind and moderator of the roguelike subreddit,
posted the blog post on reddit</li>
<li>I noticed that actually, by scraping the data like I did, I only got a sample of 100 daily games</li>
<li>This point was also discussed on Reddit, and bhhak, an UnNetHack developer (UnNetHack is a fork
of NetHack) suggested I used the xlogfiles instead</li>
<li>xlogfiles are log files generated by NetHack, and are also available on alt.org/nethack</li>
<li>I started scraping them, and getting a lot more data</li>
<li>I got contacted on twitter by <span class="citation">@paxed</span>, an admin of alt.org/nethack:</li>
</ul>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">There was no need for scraping, we&#39;ll happily give out the whole database if you want.</p>&mdash; Pasi Kallinen (@paxed) <a href="https://twitter.com/paxed/status/1059333642592366593?ref_src=twsrc%5Etfw">November 5, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<ul>
<li>He gave me access to ALL THE DATA on alt.org/nethack!</li>
<li>The admins of <a href="https://alt.org/nethack/">alt.org/nethack</a> will release all the data to the public!</li>
</ul>
<p>So, I will now continue with the blog post I wanted to do in the first place; focusing now on what
roles players choose to play the most, and also which monsters they kill the most. BUT! Since all the data
will be released to the public, my <code>{nethack}</code> package that contains data that I scraped is not
that useful anymore. So I changed the nature of the package.
Now the package contains some functions: a function to parse and prepare the xlogfiles from NetHack that
you can download from <a href="https://alt.org/nethack/">alt.org/nethack</a> (or from any other public server), a function
to download dumplogs such as this <a href="http://archive.is/7awsb">one</a>. These dumplogs contain a lot of
info that I will extract in this blog post, using another function included in the <code>{nethack}</code> package.
The package also contains a sample of 6000 runs from NetHack version 3.6.1.</p>
<p>You can install the package with the following command line:</p>
<pre class="r"><code>devtools::install_github(&quot;b-rodrigues/nethack&quot;)</code></pre>
</div>
<div id="the-nethack-package" class="section level2">
<h2>The <code>{nethack}</code> package</h2>
<p>In <a href="https://www.brodrigues.co/blog/2018-11-03-nethack_analysis/">part 1</a> I showed what killed
players the most. Here, I will focus on what monsters players kill the most.
Let’s start by loading some packages:</p>
<pre class="r"><code>library(tidyverse)
library(lubridate)
library(magrittr)
library(ggridges)
library(brotools)
library(rvest)
library(nethack)</code></pre>
<p>Let’s first describe the data:</p>
<pre class="r"><code>brotools::describe(nethack) %&gt;% 
  print(n = Inf)</code></pre>
<pre><code>## # A tibble: 23 x 17
##    variable type    nobs     mean       sd mode       min     max      q05
##    &lt;chr&gt;    &lt;chr&gt;  &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 deathdn… Nume… 6.00e3  8.45e-1  1.30e+0 2       0.      7.00e0   0.    
##  2 deathlev Nume… 6.00e3  4.32e+0  3.69e+0 10     -5.00e0  4.50e1   1.00e0
##  3 deaths   Nume… 6.00e3  8.88e-1  3.54e-1 1       0.      5.00e0   0.    
##  4 endtime  Nume… 6.00e3  1.53e+9  4.72e+6 1534…   1.52e9  1.54e9   1.53e9
##  5 hp       Nume… 6.00e3  6.64e+0  4.96e+1 -1     -9.40e1  1.79e3  -8.00e0
##  6 maxhp    Nume… 6.00e3  3.82e+1  5.29e+1 57      2.00e0  1.80e3   1.10e1
##  7 maxlvl   Nume… 6.00e3  5.52e+0  6.36e+0 10      1.00e0  5.30e1   1.00e0
##  8 points   Nume… 6.00e3  4.69e+4  4.18e+5 10523   0.      9.92e6   1.40e1
##  9 realtime Nume… 6.00e3  4.42e+3  1.60e+4 4575    0.      3.23e5   6.90e1
## 10 startti… Nume… 6.00e3  1.53e+9  4.72e+6 1534…   1.52e9  1.54e9   1.53e9
## 11 turns    Nume… 6.00e3  3.60e+3  9.12e+3 6797    3.10e1  1.97e5   9.49e1
## 12 align    Char… 6.00e3 NA       NA       Cha    NA      NA       NA     
## 13 align0   Char… 6.00e3 NA       NA       Cha    NA      NA       NA     
## 14 death    Char… 6.00e3 NA       NA       kill…  NA      NA       NA     
## 15 gender   Char… 6.00e3 NA       NA       Fem    NA      NA       NA     
## 16 gender0  Char… 6.00e3 NA       NA       Fem    NA      NA       NA     
## 17 killed_… Char… 6.00e3 NA       NA       fain…  NA      NA       NA     
## 18 name     Char… 6.00e3 NA       NA       drud…  NA      NA       NA     
## 19 race     Char… 6.00e3 NA       NA       Elf    NA      NA       NA     
## 20 role     Char… 6.00e3 NA       NA       Wiz    NA      NA       NA     
## 21 dumplog  List  1.33e6 NA       NA       &lt;NA&gt;   NA      NA       NA     
## 22 birthda… Date  6.00e3 NA       NA       &lt;NA&gt;   NA      NA       NA     
## 23 deathda… Date  6.00e3 NA       NA       &lt;NA&gt;   NA      NA       NA     
## # ... with 8 more variables: q25 &lt;dbl&gt;, median &lt;dbl&gt;, q75 &lt;dbl&gt;,
## #   q95 &lt;dbl&gt;, n_missing &lt;int&gt;, n_unique &lt;int&gt;, starting_date &lt;date&gt;,
## #   ending_date &lt;date&gt;</code></pre>
<p>All these columns are included in xlogfiles. The data was prepared using two functions, included
in <code>{nethack}</code>:</p>
<pre class="r"><code>xlog &lt;- read_delim(&quot;~/path/to/nethack361_xlog.csv&quot;, &quot;\t&quot;, escape_double = FALSE, 
                   col_names = FALSE, trim_ws = TRUE)

xlog_df &lt;- clean_xlog(xlog)</code></pre>
<p><code>nethack361_xlog.csv</code> is the raw xlogfiles that you can get from NetHack public servers.
<code>clean_xlog()</code> is a function that parses an xlogfile and returns a clean data frame.
<code>xlog_df</code> will be a data frame that will look just as the one included in <code>{nethack}</code>. It is
then possible to get the dumplog from each run included in <code>xlog_df</code> using <code>get_dumplog()</code>:</p>
<pre class="r"><code>xlog_df &lt;- get_dumplog(xlog_df)</code></pre>
<p>This function adds a column called <code>dumplog</code> with the dumplog of that run. I will now analyze
the dumplog file, by focusing on monsters vanquished, genocided or extinct. In a future blogpost
I will focus on other achievements.</p>
</div>
<div id="roles-played-and-other-starting-stats" class="section level2">
<h2>Roles played (and other starting stats)</h2>
<p>I will take a look at the races, roles, gender and alignment players start with the most. I will do
pie charts to visualize these variable, so first, let’s start by writing a general function that
allows me to do just that:</p>
<pre class="r"><code>create_pie &lt;- function(dataset, variable, repel = FALSE){

  if(repel){
    geom_label &lt;- function(...){
      ggrepel::geom_label_repel(...)
    }
  }

  variable &lt;- enquo(variable)

  dataset %&gt;%
    count((!!variable)) %&gt;%
    mutate(total = sum(n),
           freq = n/total,
           labels = scales::percent(freq)) %&gt;% 
    arrange(desc(freq)) %&gt;%
    ggplot(aes(x = &quot;&quot;, y = freq, fill = (!!variable))) + 
    geom_col() + 
    geom_label(aes(label = labels), position = position_stack(vjust = 0.25), show.legend = FALSE) + 
    coord_polar(&quot;y&quot;) + 
    theme_blog() + 
    scale_fill_blog() + 
    theme(legend.title = element_blank(),
          panel.grid = element_blank(),
          axis.text = element_blank(),
          axis.title = element_blank())
}</code></pre>
<p>Now I can easily plot the share of races chosen:</p>
<pre class="r"><code>create_pie(nethack, race)</code></pre>
<p><img src="../../blog/2018-11-10-nethack_analysis_part2_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>or the share of alignment:</p>
<pre class="r"><code>create_pie(nethack, align0)</code></pre>
<p><img src="../../blog/2018-11-10-nethack_analysis_part2_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Same for the share of gender:</p>
<pre class="r"><code>create_pie(nethack, gender0)</code></pre>
<p><img src="../../blog/2018-11-10-nethack_analysis_part2_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>and finally for the share of roles:</p>
<pre class="r"><code>create_pie(nethack, role, repel = TRUE) </code></pre>
<p><img src="../../blog/2018-11-10-nethack_analysis_part2_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p><code>create_pie()</code> is possible thanks to <em>tidy evaluation</em> in <a href="https://www.tidyverse.org/articles/2018/07/ggplot2-3-0-0/"><code>{ggplot2}</code></a>,
which makes it possible to write a function that passes data frame columns down to <code>aes()</code>. Before
version 3.0 of <code>{ggplot2}</code> this was not possible, and writing such a function would have been a bit
more complicated. Now, it’s as easy as pie, if I dare say.</p>
<p>Something else I want to look at, is the distribution of turns by role:</p>
<pre class="r"><code>nethack %&gt;%
  filter(turns &lt; quantile(turns, 0.98)) %&gt;%
  ggplot(aes(x = turns, y = role, group = role, fill = role)) +
    geom_density_ridges(scale = 6, size = 0.25, rel_min_height = 0.01) + 
    theme_blog() + 
    scale_fill_blog() + 
    theme(axis.text.y = element_blank(),
          axis.title.y = element_blank())</code></pre>
<pre><code>## Picking joint bandwidth of 486</code></pre>
<p><img src="../../blog/2018-11-10-nethack_analysis_part2_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>I use the very cool <code>{ggridges}</code> package for that. The distribution seems to mostly be the same
(of course, one should do a statistical test to be sure), but the one for the role “Valkyrie”
seems to be quite different from the others. It is known that it is easier to win the game playing
as a Valkyrie, but a question remains: is it really easier as a Valkyrie, or do good players tend
to play as Valkyries more often?</p>
</div>
<div id="creatures-vanquished-genocided-or-extinct" class="section level2">
<h2>Creatures vanquished, genocided or extinct</h2>
<p>The dumplog lists which, and how many of which, creatures were vanquished during the run, as well
as creatures that were genocided and extinct. The player can genocide an entire species by reading
a <em>scroll of genocide</em> (or by sitting on a throne). A species gets extinct if the player manages to
kill every monster from that species (there’s other ways too, but for the sake of simplicity, let’s
just say that when the players kills every monster from a species, the species is extinct).
The following lines are an extract of a dumplog:</p>
<pre><code>&quot;Vanquished creatures:&quot;
&quot;    Baalzebub&quot;
&quot;    Orcus&quot;
&quot;    Juiblex&quot;
&quot;the Wizard of Yendor (4 times)&quot;
&quot;    Pestilence (thrice)&quot;
&quot;    Famine&quot;
&quot;    Vlad the Impaler&quot;
&quot;  4 arch-liches&quot;
&quot;  an arch-lich&quot;
&quot;  a high priest&quot;
&quot;...&quot;
&quot;...&quot;
&quot;...&quot;
&quot;2873 creatures vanquished.&quot; </code></pre>
<p>If I want to analyze this, I have to first solve some problems:</p>
<ul>
<li>Replace “a” and “an” by “1”</li>
<li>Put the digit in the string “(4 times)” in front of the name of the monster (going from “the Wizard of Yendor (4 times)” to “4 the Wizard of Yendor”)</li>
<li>Do something similar for “twice” and “thrice”</li>
<li>Put everything into singular (for example, arch-liches into arch-lich)</li>
<li>Trim whitespace</li>
<li>Extract the genocided or extinct status from the dumplog too</li>
<li>Finally, return a data frame with all the needed info</li>
</ul>
<p>I wrote a function called <code>extracted_defeated_monsters()</code> and included it in the <code>{nethack}</code> package.
I discuss this function in appendix, but what it does is extracting information from dumplog files
about vanquished, genocided or extinct monsters and returns a tidy dataframe with that info. This
function has a lot of things going on inside it, so if you’re interested in learning more about
regular expression and other <code>{tidyverse}</code> tricks, I really encourage you to read its source code.</p>
<p>I can now easily add this info to my data:</p>
<pre class="r"><code>nethack %&lt;&gt;%
  mutate(monsters_destroyed = map(dumplog, ~possibly(extract_defeated_monsters, otherwise = NA)(.)))</code></pre>
<p>Let’s take a look at one of them:</p>
<pre class="r"><code>nethack$monsters_destroyed[[117]]</code></pre>
<pre><code>## # A tibble: 285 x 3
##    value monster              status
##    &lt;dbl&gt; &lt;chr&gt;                &lt;chr&gt; 
##  1     1 baalzebub            &lt;NA&gt;  
##  2     1 orcu                 &lt;NA&gt;  
##  3     1 juiblex              &lt;NA&gt;  
##  4     4 the wizard of yendor &lt;NA&gt;  
##  5     3 pestilence           &lt;NA&gt;  
##  6     1 famine               &lt;NA&gt;  
##  7     1 vlad the impaler     &lt;NA&gt;  
##  8     4 arch-lich            &lt;NA&gt;  
##  9     1 high priest          &lt;NA&gt;  
## 10     1 medusa               &lt;NA&gt;  
## # ... with 275 more rows</code></pre>
<pre class="r"><code>nethack$monsters_destroyed[[117]] %&gt;% 
  count(status)</code></pre>
<pre><code>## # A tibble: 3 x 2
##   status        n
##   &lt;chr&gt;     &lt;int&gt;
## 1 extinct       2
## 2 genocided     7
## 3 &lt;NA&gt;        276</code></pre>
<p>The status variable tells us if that monster was genocided or extinct during that run. <code>status</code>
equal to “NA” means vanquished.</p>
<p>It is now possible to look at, say, the top 15 vanquished monsters (normalized):</p>
<pre class="r"><code>nethack %&gt;%
  filter(!is.na(monsters_destroyed)) %&gt;%
  pull(monsters_destroyed) %&gt;%
  bind_rows %&gt;%
  group_by(monster) %&gt;%
  summarise(total = sum(value)) %&gt;%
  top_n(15) %&gt;%
  ungroup() %&gt;%
  mutate(norm_total = (total - min(total))/(max(total) - min(total))) %&gt;%
  mutate(monster = fct_reorder(monster, norm_total, .desc = FALSE)) %&gt;%
  ggplot() + 
  geom_col(aes(y = norm_total, x = monster)) + 
  coord_flip() + 
  theme_blog() + 
  scale_fill_blog() + 
  ylab(&quot;Ranking&quot;) +
  xlab(&quot;Monster&quot;)</code></pre>
<pre><code>## Selecting by total</code></pre>
<p><img src="../../blog/2018-11-10-nethack_analysis_part2_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>In this type of graph, the most vanquished monster, “gnome” has a value of 1, and the least
vanquished one, 0. This normalization step is also used in the pre-processing step of machine learning
algorithms. This helps convergence of the gradient descent algorithm for instance.</p>
<p>Monsters can also get genocided or extinct. Let’s make a pie chart of the proportion of genocided
and extinct monsters (I lump monsters that are genocided or extinct less than 5% of the times
into a category called other). Because I want two pie charts, I nest the data after having grouped
it by the status variable. This is a trick I discussed in this blog <a href="https://www.brodrigues.co/blog/2017-03-29-make-ggplot2-purrr/">post</a>
and that I use very often:</p>
<pre class="r"><code>nethack %&gt;%
  filter(!is.na(monsters_destroyed)) %&gt;%
  pull(monsters_destroyed) %&gt;%
  bind_rows %&gt;%
  filter(!is.na(status)) %&gt;%
  group_by(status) %&gt;% 
  count(monster) %&gt;% 
  mutate(monster = fct_lump(monster, prop = 0.05, w = n)) %&gt;% 
  group_by(status, monster) %&gt;% 
  summarise(total_count = sum(n)) %&gt;%
  mutate(freq = total_count/sum(total_count),
         labels = scales::percent(freq)) %&gt;%
  arrange(desc(freq)) %&gt;%
  group_by(status) %&gt;%
  nest() %&gt;%
  mutate(pie_chart = map2(.x = status,
                          .y = data,
                          ~ggplot(data = .y,
                                  aes(x = &quot;&quot;, y = freq, fill = (monster))) + 
    geom_col() + 
    ggrepel::geom_label_repel(aes(label = labels), position = position_stack(vjust = 0.25), show.legend = FALSE) + 
    coord_polar(&quot;y&quot;) + 
    theme_blog() + 
    scale_fill_blog() + 
      ggtitle(.x) +
    theme(legend.title = element_blank(),
          panel.grid = element_blank(),
          axis.text = element_blank(),
          axis.title = element_blank())
  )) %&gt;%
  pull(pie_chart)</code></pre>
<pre><code>## Warning in mutate_impl(.data, dots): Unequal factor levels: coercing to
## character</code></pre>
<pre><code>## Warning in mutate_impl(.data, dots): binding character and factor vector,
## coercing into character vector

## Warning in mutate_impl(.data, dots): binding character and factor vector,
## coercing into character vector</code></pre>
<pre><code>## [[1]]</code></pre>
<p><img src="../../blog/2018-11-10-nethack_analysis_part2_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="../../blog/2018-11-10-nethack_analysis_part2_files/figure-html/unnamed-chunk-17-2.png" width="672" /></p>
<p>That was it for this one, the graphs are not that super sexy, but the amount of work that went
into making them was quite consequent. The main reason was that parsing xlogfiles was a bit tricky, but
the main challenge was extracting information from dumplog files. This proved to be a bit more
complicated than expected (just take a look at the source code of <code>extract_defeated_monsters()</code>
to get an idea…).</p>
<p>Hope you enjoyed! If you found this blog post useful, you might want to follow
me on <a href="https://www.twitter.com/brodriguesco">twitter</a> for blog post updates or
<a href="https://www.buymeacoffee.com/brodriguesco">buy me an espresso</a>.</p>
<style>.bmc-button img{width: 27px !important;margin-bottom: 1px !important;box-shadow: none !important;border: none !important;vertical-align: middle !important;}.bmc-button{line-height: 36px !important;height:37px !important;text-decoration: none !important;display:inline-flex !important;color:#ffffff !important;background-color:#272b30 !important;border-radius: 3px !important;border: 1px solid transparent !important;padding: 1px 9px !important;font-size: 22px !important;letter-spacing:0.6px !important;box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;margin: 0 auto !important;font-family:'Cookie', cursive !important;-webkit-box-sizing: border-box !important;box-sizing: border-box !important;-o-transition: 0.3s all linear !important;-webkit-transition: 0.3s all linear !important;-moz-transition: 0.3s all linear !important;-ms-transition: 0.3s all linear !important;transition: 0.3s all linear !important;}.bmc-button:hover, .bmc-button:active, .bmc-button:focus {-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;text-decoration: none !important;box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;opacity: 0.85 !important;color:#82518c !important;}</style>
<p><link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet"><a class="bmc-button" target="_blank" href="https://www.buymeacoffee.com/brodriguesco"><img src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg" alt="Buy me an Espresso"><span style="margin-left:5px">Buy me an Espresso</span></a></p>
</div>
<div id="bonus-plot" class="section level2">
<h2>Bonus plot</h2>
<div id="correct-number-of-daily-games" class="section level3">
<h3>Correct number of daily games</h3>
<p>The daily number of games are available <a href="https://alt.org/nethack/dailygames_ct.html">here</a>. Let’s
extract this info and remake the plot that shows the number of runs per day:</p>
<pre class="r"><code>games &lt;- read_html(&quot;https://alt.org/nethack/dailygames_ct.html&quot;) %&gt;%
        html_nodes(xpath = &#39;//table&#39;) %&gt;%
        html_table(fill = TRUE) </code></pre>
<p>This extracts all the tables and puts them into a list. Let’s take a look at one:</p>
<pre class="r"><code>head(games[[1]])</code></pre>
<pre><code>##   2018  2018 2018 2018 2018 2018 2018 2018 2018 2018 2018 2018 2018 2018
## 1         NA    1    2    3    4    5    6    7    8    9   10   11   12
## 2  Jan 11639  275  370  394  363  392  276  288  324  297  411  413  430
## 3  Feb 10819  375  384  359  376  440  345  498  457  416  376  421  416
## 4  Mar 12148  411  403  421  392  447  391  451  298  350  309  309  369
## 5  Apr 13957  456  513  482  516  475  490  397  431  436  438  541  493
## 6  May 13361  595  509  576  620  420  443  407  539  440  446  404  282
##   2018 2018 2018 2018 2018 2018 2018 2018 2018 2018 2018 2018 2018 2018
## 1   13   14   15   16   17   18   19   20   21   22   23   24   25   26
## 2  331  341  318  483  408  424  464  412  371  430  348  315  359  375
## 3  385  367  443  324  283  341  385  398  361  379  399  276  455  460
## 4  390  358  362  345  388  360  411  382  371  400  410  417  328  431
## 5  593  537  396  578  403  435  526  448  339  377  476  492  528  393
## 6  265  358  419  564  483  429  423  299  424  404  450  408  355  409
##   2018 2018 2018 2018 2018
## 1   27   28   29   30   31
## 2  432  371  385  440  399
## 3  353  347   NA   NA   NA
## 4  386  484  493  486  395
## 5  407  421  463  477   NA
## 6  417  433  360  391  389</code></pre>
<p>Let’s clean this up.</p>
<pre class="r"><code>clean_table &lt;- function(df){
  # Promotes first row to header
  colnames(df) &lt;- df[1, ]
  df &lt;- df[-1, ]
  
  # Remove column with total from the month
  df &lt;- df[, -2]
  
  # Name the first column &quot;month&quot;
  
  colnames(df)[1] &lt;- &quot;month&quot;
  
  # Now put it in a tidy format
  df %&gt;%
    gather(day, games_played, -month)
}</code></pre>
<p>Now I can clean up all the tables. I apply this function to each element of the list <code>games</code>. I
also add a year column:</p>
<pre class="r"><code>games &lt;- map(games, clean_table) %&gt;%
  map2_dfr(.x = ., 
       .y = seq(2018, 2001),
       ~mutate(.x, year = .y))</code></pre>
<p>Now I can easily create the plot I wanted</p>
<pre class="r"><code>games %&lt;&gt;%
  mutate(date = lubridate::ymd(paste(year, month, day, sep = &quot;-&quot;)))</code></pre>
<pre><code>## Warning: 122 failed to parse.</code></pre>
<pre class="r"><code>ggplot(games, aes(y = games_played, x = date)) + 
  geom_point(colour = &quot;#0f4150&quot;) + 
  geom_smooth(colour = &quot;#82518c&quot;) + 
  theme_blog() + 
  ylab(&quot;Total games played&quot;)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<pre><code>## Warning: Removed 452 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 452 rows containing missing values (geom_point).</code></pre>
<p><img src="../../blog/2018-11-10-nethack_analysis_part2_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>There’s actually a lot more games than 50 per day being played!</p>
</div>
</div>
<div id="appendix" class="section level2">
<h2>Appendix</h2>
<div id="fuzzy-matching" class="section level3">
<h3>Fuzzy matching</h3>
<p>If you take a look at the <code>extract_defeated_monsters()</code> source code, you’ll see that at some point
I “singularize” monster names. I decided to deal with this singular/plural issue, “by hand”,
but also explored other possibilities, such as matching the plural nouns with the singular
nouns fuzzily. In the end it didn’t work out so well, but here’s the code for future reference.</p>
<pre class="r"><code>monster_list &lt;- read_html(&quot;https://nethackwiki.com/wiki/Monsters_(by_difficulty)&quot;) %&gt;%
    html_nodes(&quot;.prettytable&quot;) %&gt;% 
    .[[1]] %&gt;%
    html_table(fill = TRUE)

monster_list %&lt;&gt;%
    select(monster = Name)

head(monster_list)</code></pre>
<pre><code>##      monster
## 1 Demogorgon
## 2   Asmodeus
## 3  Baalzebub
## 4   Dispater
## 5     Geryon
## 6      Orcus</code></pre>
<pre class="r"><code>library(fuzzyjoin)

test_vanquished &lt;- extract_defeated_monsters(nethack$dumplog[[117]])

head(test_vanquished)</code></pre>
<pre><code>## # A tibble: 6 x 3
##   value monster              status
##   &lt;dbl&gt; &lt;chr&gt;                &lt;chr&gt; 
## 1     1 baalzebub            &lt;NA&gt;  
## 2     1 orcu                 &lt;NA&gt;  
## 3     1 juiblex              &lt;NA&gt;  
## 4     4 the wizard of yendor &lt;NA&gt;  
## 5     3 pestilence           &lt;NA&gt;  
## 6     1 famine               &lt;NA&gt;</code></pre>
<p>You can take a look at the result by expanding:</p>
<details>
<p><summary>Click to expand</summary></p>
<pre class="r"><code>stringdist_left_join(test_vanquished, monster_list) %&gt;% 
  count(monster.y) %&gt;%
  print(n = Inf)</code></pre>
<pre><code>## Joining by: &quot;monster&quot;</code></pre>
<pre><code>## # A tibble: 297 x 2
##     monster.y                   n
##     &lt;chr&gt;                   &lt;int&gt;
##   1 acid blob                   1
##   2 air elemental               2
##   3 Aleax                       1
##   4 aligned priest              1
##   5 Angel                       1
##   6 ape                         2
##   7 arch-lich                   1
##   8 Baalzebub                   1
##   9 baby black dragon           1
##  10 baby crocodile              1
##  11 baby gray dragon            1
##  12 baby green dragon           1
##  13 baby long worm              1
##  14 baby orange dragon          1
##  15 baby white dragon           1
##  16 baby yellow dragon          1
##  17 balrog                      1
##  18 baluchitherium              1
##  19 barbed devil                1
##  20 barrow wight                1
##  21 bat                         1
##  22 black dragon                1
##  23 black light                 1
##  24 black naga                  1
##  25 black pudding               1
##  26 black unicorn               1
##  27 blue dragon                 1
##  28 blue jelly                  1
##  29 bone devil                  1
##  30 brown mold                  1
##  31 brown pudding               1
##  32 bugbear                     1
##  33 captain                     1
##  34 carnivorous ape             1
##  35 cave spider                 1
##  36 centipede                   1
##  37 chameleon                   1
##  38 chickatrice                 2
##  39 clay golem                  1
##  40 cobra                       1
##  41 cockatrice                  2
##  42 couatl                      1
##  43 coyote                      1
##  44 crocodile                   1
##  45 demilich                    1
##  46 dingo                       1
##  47 disenchanter                1
##  48 dog                         1
##  49 doppelganger                1
##  50 dust vortex                 1
##  51 dwarf                       2
##  52 dwarf king                  1
##  53 dwarf lord                  1
##  54 dwarf mummy                 1
##  55 dwarf zombie                1
##  56 earth elemental             1
##  57 electric eel                1
##  58 elf                         1
##  59 elf mummy                   1
##  60 elf zombie                  1
##  61 elf-lord                    1
##  62 Elvenking                   1
##  63 energy vortex               1
##  64 erinys                      1
##  65 ettin                       1
##  66 ettin mummy                 1
##  67 ettin zombie                1
##  68 Famine                      1
##  69 fire ant                    2
##  70 fire elemental              2
##  71 fire giant                  2
##  72 fire vortex                 2
##  73 flaming sphere              1
##  74 flesh golem                 1
##  75 floating eye                1
##  76 fog cloud                   1
##  77 forest centaur              1
##  78 fox                         1
##  79 freezing sphere             1
##  80 frost giant                 1
##  81 gargoyle                    1
##  82 garter snake                1
##  83 gas spore                   1
##  84 gecko                       1
##  85 gelatinous cube             1
##  86 ghost                       2
##  87 ghoul                       2
##  88 giant ant                   3
##  89 giant bat                   3
##  90 giant beetle                1
##  91 giant eel                   1
##  92 giant mimic                 1
##  93 giant mummy                 1
##  94 giant rat                   3
##  95 giant spider                1
##  96 giant zombie                1
##  97 glass piercer               1
##  98 gnome                       1
##  99 gnome king                  1
## 100 gnome lord                  1
## 101 gnome mummy                 1
## 102 gnome zombie                1
## 103 gnomish wizard              1
## 104 goblin                      1
## 105 gold golem                  2
## 106 golden naga                 1
## 107 golden naga hatchling       1
## 108 gray ooze                   1
## 109 gray unicorn                1
## 110 Green-elf                   1
## 111 gremlin                     1
## 112 Grey-elf                    1
## 113 grid bug                    1
## 114 guardian naga               1
## 115 guardian naga hatchling     1
## 116 hell hound                  1
## 117 hell hound pup              1
## 118 hezrou                      1
## 119 high priest                 1
## 120 hill giant                  1
## 121 hill orc                    1
## 122 hobbit                      1
## 123 hobgoblin                   1
## 124 homunculus                  1
## 125 horned devil                1
## 126 horse                       2
## 127 housecat                    1
## 128 human                       1
## 129 human mummy                 1
## 130 human zombie                1
## 131 ice devil                   1
## 132 ice troll                   1
## 133 ice vortex                  2
## 134 iguana                      1
## 135 imp                         1
## 136 incubus                     1
## 137 iron golem                  1
## 138 iron piercer                1
## 139 jabberwock                  1
## 140 jackal                      1
## 141 jaguar                      1
## 142 jellyfish                   1
## 143 Juiblex                     1
## 144 Keystone Kop                1
## 145 ki-rin                      1
## 146 killer bee                  1
## 147 kitten                      1
## 148 kobold                      1
## 149 kobold lord                 1
## 150 kobold mummy                1
## 151 kobold shaman               1
## 152 kobold zombie               1
## 153 Kop Lieutenant              1
## 154 Kop Sergeant                1
## 155 kraken                      2
## 156 large cat                   1
## 157 large dog                   1
## 158 large kobold                1
## 159 large mimic                 1
## 160 leather golem               1
## 161 leocrotta                   1
## 162 leprechaun                  1
## 163 lich                        2
## 164 lichen                      2
## 165 lieutenant                  1
## 166 little dog                  1
## 167 lizard                      1
## 168 long worm                   1
## 169 Lord Surtur                 1
## 170 lurker above                1
## 171 lynx                        1
## 172 manes                       1
## 173 marilith                    1
## 174 master lich                 1
## 175 master mind flayer          1
## 176 Medusa                      1
## 177 mind flayer                 1
## 178 minotaur                    1
## 179 monk                        2
## 180 monkey                      1
## 181 Mordor orc                  1
## 182 mountain centaur            1
## 183 mountain nymph              1
## 184 mumak                       1
## 185 nalfeshnee                  1
## 186 Nazgul                      1
## 187 newt                        1
## 188 Norn                        1
## 189 nurse                       2
## 190 ochre jelly                 1
## 191 ogre                        1
## 192 ogre king                   1
## 193 ogre lord                   1
## 194 Olog-hai                    1
## 195 orange dragon               1
## 196 orc                         3
## 197 orc mummy                   1
## 198 orc shaman                  1
## 199 orc zombie                  1
## 200 orc-captain                 1
## 201 Orcus                       1
## 202 owlbear                     1
## 203 page                        2
## 204 panther                     1
## 205 paper golem                 1
## 206 Pestilence                  1
## 207 piranha                     1
## 208 pit fiend                   1
## 209 pit viper                   1
## 210 plains centaur              1
## 211 pony                        1
## 212 purple worm                 1
## 213 pyrolisk                    1
## 214 python                      1
## 215 quantum mechanic            1
## 216 quasit                      1
## 217 queen bee                   1
## 218 quivering blob              1
## 219 rabid rat                   1
## 220 ranger                      1
## 221 raven                       2
## 222 red dragon                  1
## 223 red mold                    1
## 224 red naga                    1
## 225 rock mole                   1
## 226 rock piercer                1
## 227 rock troll                  1
## 228 rogue                       2
## 229 rope golem                  1
## 230 roshi                       1
## 231 rothe                       1
## 232 rust monster                1
## 233 salamander                  1
## 234 sandestin                   1
## 235 sasquatch                   1
## 236 scorpion                    1
## 237 sergeant                    1
## 238 sewer rat                   1
## 239 shade                       3
## 240 shark                       2
## 241 shocking sphere             1
## 242 shrieker                    1
## 243 silver dragon               1
## 244 skeleton                    1
## 245 small mimic                 1
## 246 snake                       2
## 247 soldier                     1
## 248 soldier ant                 1
## 249 spotted jelly               1
## 250 stalker                     1
## 251 steam vortex                1
## 252 stone giant                 2
## 253 stone golem                 1
## 254 storm giant                 2
## 255 straw golem                 1
## 256 succubus                    1
## 257 tengu                       1
## 258 tiger                       1
## 259 titanothere                 1
## 260 trapper                     1
## 261 troll                       1
## 262 umber hulk                  1
## 263 Uruk-hai                    1
## 264 vampire                     1
## 265 vampire bat                 1
## 266 vampire lord                1
## 267 violet fungus               1
## 268 Vlad the Impaler            1
## 269 vrock                       1
## 270 warg                        2
## 271 warhorse                    1
## 272 water elemental             1
## 273 water moccasin              1
## 274 water nymph                 1
## 275 werejackal                  2
## 276 wererat                     2
## 277 werewolf                    2
## 278 white dragon                1
## 279 white unicorn               1
## 280 winged gargoyle             1
## 281 winter wolf                 1
## 282 winter wolf cub             1
## 283 wizard                      1
## 284 wolf                        1
## 285 wood golem                  2
## 286 wood nymph                  1
## 287 Woodland-elf                1
## 288 wraith                      1
## 289 wumpus                      1
## 290 xan                         3
## 291 xorn                        2
## 292 yellow dragon               1
## 293 yellow light                1
## 294 yellow mold                 1
## 295 yeti                        1
## 296 zruty                       1
## 297 &lt;NA&gt;                        1</code></pre>
</details>
<p>As you can see, some matches fail, especially for words that end in “y” in the singular, so “ies”
in plural, or “fire vortices” that does not get matched to “fire vortex”. I tried all the methods
but it’s either worse, or marginally better.</p>
</div>
<div id="extracting-info-from-dumplogfiles" class="section level3">
<h3>Extracting info from dumplogfiles</h3>
<details>
<p><summary>Click here to take a look at the source code from extract_defeated_monsters</summary></p>
<pre class="r"><code>#&#39; Extract information about defeated monsters from an xlogfile
#&#39; @param xlog A raw xlogfile
#&#39; @return A data frame with information on vanquished, genocided and extincted monsters
#&#39; @importFrom dplyr mutate select filter bind_rows full_join
#&#39; @importFrom tidyr separate
#&#39; @importFrom tibble as_tibble tibble
#&#39; @importFrom magrittr &quot;%&gt;%&quot;
#&#39; @importFrom purrr map2 possibly is_empty modify_if simplify discard
#&#39; @importFrom readr read_lines
#&#39; @importFrom stringr str_which str_replace_all str_replace str_trim str_detect str_to_lower str_extract_all str_extract
#&#39; @export
#&#39; @examples
#&#39; \dontrun{
#&#39; get_dumplog(xlog)
#&#39; }
extract_defeated_monsters &lt;- function(dumplog){

    if(any(str_detect(dumplog, &quot;No creatures were vanquished.&quot;))){
        return(NA)
    } else {

        start &lt;- dumplog %&gt;% # &lt;- dectect the start of the list
            str_which(&quot;Vanquished creatures&quot;)

        end &lt;- dumplog %&gt;% # &lt;- detect the end of the list
            str_which(&quot;\\d+ creatures vanquished.&quot;)

        if(is_empty(end)){ # This deals with the situation of only one vanquished creature
            end &lt;- start + 2
        }

        list_creatures &lt;- dumplog[(start + 1):(end - 1)] %&gt;% # &lt;- extract the list
            str_replace_all(&quot;\\s+an? &quot;, &quot;1 &quot;) %&gt;% # &lt;- replace a or an by 1
            str_trim() # &lt;- trim white space

        # The following function first extracts the digit in the string (123 times)
        # and replaces the 1 with this digit
        # This means that: &quot;1 the Wizard of Yendor (4 times)&quot; becomes &quot;4 the Wizard of Yendor (4 times)&quot;
        str_extract_replace &lt;- function(string){
            times &lt;- str_extract(string, &quot;\\d+(?=\\stimes)&quot;)
            str_replace(string, &quot;1&quot;, times)
        }

        result &lt;- list_creatures %&gt;%
            # If a string starts with a letter, add a 1
            # This means that: &quot;Baalzebub&quot; becomes &quot;1 Baalzebub&quot;
            modify_if(str_detect(., &quot;^[:alpha:]&quot;), ~paste(&quot;1&quot;, .)) %&gt;%
            # If the string &quot;(twice)&quot; is detected, replace &quot;1&quot; (that was added the line before) with &quot;2&quot;
            modify_if(str_detect(., &quot;(twice)&quot;), ~str_replace(., &quot;1&quot;, &quot;2&quot;)) %&gt;%
            # Same for &quot;(thrice)&quot;
            modify_if(str_detect(., &quot;(thrice)&quot;), ~str_replace(., &quot;1&quot;, &quot;3&quot;)) %&gt;%
            # Exctract the digit in &quot;digit times&quot; and replace the &quot;1&quot; with digit
            modify_if(str_detect(., &quot;(\\d+ times)&quot;), str_extract_replace) %&gt;%
            # Replace &quot;(times)&quot; or &quot;(twice)&quot; etc with &quot;&quot;
            str_replace_all(&quot;\\(.*\\)&quot;, &quot;&quot;) %&gt;%
            str_trim() %&gt;%
            simplify() %&gt;%
            # Convert the resulting list to a tibble. This tibble has one column:
            # value
            # 1 Baalzebub
            # 2 dogs
            #...
            as_tibble() %&gt;%
            # Use tidyr::separate to separate the &quot;value&quot; column into two columns. The extra pieces get merged
            # So for example &quot;1 Vlad the Impaler&quot; becomes &quot;1&quot; &quot;Vlad the Impaler&quot; instead of &quot;1&quot; &quot;Vlad&quot; which
            # would be the case without &quot;extra = &quot;merge&quot;&quot;
            separate(value, into = c(&quot;value&quot;, &quot;monster&quot;), extra = &quot;merge&quot;) %&gt;%
            mutate(value = as.numeric(value)) %&gt;%
            mutate(monster = str_to_lower(monster))

        # This function singularizes names:
        singularize_monsters &lt;- function(nethack_data){
            nethack_data %&gt;%
                mutate(monster = str_replace_all(monster, &quot;mummies&quot;, &quot;mummy&quot;),
                       monster = str_replace_all(monster, &quot;jellies&quot;, &quot;jelly&quot;),
                       monster = str_replace_all(monster, &quot;vortices&quot;, &quot;vortex&quot;),
                       monster = str_replace_all(monster, &quot;elves&quot;, &quot;elf&quot;),
                       monster = str_replace_all(monster, &quot;wolves&quot;, &quot;wolf&quot;),
                       monster = str_replace_all(monster, &quot;dwarves&quot;, &quot;dwarf&quot;),
                       monster = str_replace_all(monster, &quot;liches&quot;, &quot;lich&quot;),
                       monster = str_replace_all(monster, &quot;baluchiteria&quot;, &quot;baluchiterium&quot;),
                       monster = str_replace_all(monster, &quot;homunculi&quot;, &quot;homonculus&quot;),
                       monster = str_replace_all(monster, &quot;mumakil&quot;, &quot;mumak&quot;),
                       monster = str_replace_all(monster, &quot;sasquatches&quot;, &quot;sasquatch&quot;),
                       monster = str_replace_all(monster, &quot;watchmen&quot;, &quot;watchman&quot;),
                       monster = str_replace_all(monster, &quot;zruties&quot;, &quot;zruty&quot;),
                       monster = str_replace_all(monster, &quot;xes$&quot;, &quot;x&quot;),
                       monster = str_replace_all(monster, &quot;s$&quot;, &quot;&quot;))
        }

        result &lt;- singularize_monsters(result)
    }
    # If a player did not genocide or extinct any species, return the result:
    if(any(str_detect(dumplog, &quot;No species were genocided or became extinct.&quot;))){
        result &lt;- result %&gt;%
            mutate(status = NA_character_)
        return(result)
    } else {

        # If the player genocided or extincted species, add this info:
        start &lt;- dumplog %&gt;% # &lt;- dectect the start of the list
            str_which(&quot;Genocided or extinct species:&quot;) # &lt;- sometimes this does not appear in the xlogfile

        end &lt;- dumplog %&gt;% # &lt;- detect the end of the list
            str_which(&quot;Voluntary challenges&quot;)

       if(is_empty(start)){# This deals with the situation start does not exist
           start &lt;- end - 2
       }

        list_creatures &lt;- dumplog[(start + 1):(end - 1)] %&gt;% # &lt;- extract the list
            str_trim() # &lt;- trim white space

        extinct_species &lt;- list_creatures %&gt;%
            str_extract_all(&quot;[:alpha:]+\\s(?=\\(extinct\\))&quot;, simplify = T) %&gt;%
            str_trim %&gt;%
            discard(`==`(., &quot;&quot;))

        extinct_species_df &lt;- tibble(monster = extinct_species, status = &quot;extinct&quot;)

        genocided_species_index &lt;- list_creatures %&gt;%
            str_detect(pattern = &quot;extinct|species&quot;) %&gt;%
            `!`

        genocided_species &lt;- list_creatures[genocided_species_index]

        genocided_species_df &lt;- tibble(monster = genocided_species, status = &quot;genocided&quot;)

        genocided_or_extinct_df &lt;- singularize_monsters(bind_rows(extinct_species_df, genocided_species_df))

        result &lt;- full_join(result, genocided_or_extinct_df, by = &quot;monster&quot;) %&gt;%
            filter(monster != &quot;&quot;) # &lt;- this is to remove lines that were added by mistake, for example if start was empty

        return(result)
    }
}</code></pre>
</details>
</div>
</div>

      </div>
    </div>
  <div class="row">
    <div class="col-lg-9 col-md-9 col-sm-8 col-lg-offset-3 col-md-offset-3">
    <footer>
  <div class="row">
    <div class="col-lg-12">
      <p>Copyright 2020. <a> Bruno Rodrigues</a> </p>
      <p>Made with the HUGO theme <a href="https://github.com/adejoux/hugo-darkdoc-theme" rel="nofollow">darkdoc</a>.</p>
    </div>
  </div>
</footer>

</body>

    </div>
  </div>

</div>
</html>
<script>

  var api_url = '';

</script>
<script src="//code.jquery.com/jquery-2.2.3.min.js"></script>
<script src="../../js/application.js"></script>
<script type="text/javascript" src="../../js/jquery.fancybox.pack.js?v=2.1.5"></script>
<script type="text/javascript" src="../../js/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
<script type="text/javascript" src="../../js/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../js/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<script type="text/javascript">
  $(document).ready(function() {
    $(".fancybox").fancybox();
  });
</script>

